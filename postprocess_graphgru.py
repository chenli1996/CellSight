import matplotlib.pyplot as plt
import numpy as np
import os
import sys
import pandas as pd

def plot_loss():
    # read graphgruloss.txt.npy from ./data/
    loss = np.load('./data/graphgruloss.txt.npy')
    print(loss)
    # plt.plot(np.log(loss))
    plt.plot(loss)
    plt.xlabel('Epoch')
    plt.ylabel('Loss')
    plt.title('GraphGRU Loss')
    # plt.show()
    plt.savefig('./data/graphgru_training_loss.png')

def plot_loss_from_string():
    loss_string = '''133it [05:01,  2.27s/it]
epoch:0,  loss: 0.02686
model saved
133it [04:51,  2.19s/it]
epoch:1,  loss: 0.02256
133it [04:51,  2.19s/it]
epoch:2,  loss: 0.02225
133it [04:52,  2.20s/it]
epoch:3,  loss: 0.02205
133it [04:50,  2.18s/it]
epoch:4,  loss: 0.02188
133it [04:50,  2.19s/it]
epoch:5,  loss: 0.02170
133it [04:50,  2.19s/it]
epoch:6,  loss: 0.02151
133it [04:51,  2.19s/it]
epoch:7,  loss: 0.02135
133it [04:50,  2.19s/it]
epoch:8,  loss: 0.02115
133it [04:51,  2.19s/it]
epoch:9,  loss: 0.02110
133it [04:51,  2.19s/it]
epoch:10,  loss: 0.02098
model saved
133it [04:50,  2.18s/it]
epoch:11,  loss: 0.02090
133it [04:51,  2.19s/it]
epoch:12,  loss: 0.02079
133it [04:51,  2.19s/it]
epoch:13,  loss: 0.02080
133it [04:52,  2.20s/it]
epoch:14,  loss: 0.02074
133it [04:50,  2.18s/it]
epoch:15,  loss: 0.02073
133it [04:49,  2.18s/it]
epoch:16,  loss: 0.02064
133it [04:50,  2.19s/it]
epoch:17,  loss: 0.02093
133it [04:50,  2.18s/it]
epoch:18,  loss: 0.02092
133it [04:51,  2.19s/it]
epoch:19,  loss: 0.02047
133it [05:06,  2.30s/it]
epoch:20,  loss: 0.02046
model saved
133it [04:53,  2.20s/it]
epoch:21,  loss: 0.02043
133it [04:47,  2.16s/it]
epoch:22,  loss: 0.02038
133it [04:44,  2.14s/it]
epoch:23,  loss: 0.02035
133it [04:42,  2.13s/it]
epoch:24,  loss: 0.02031
133it [04:41,  2.11s/it]
epoch:25,  loss: 0.02036
133it [04:41,  2.12s/it]
epoch:26,  loss: 0.02047
133it [04:41,  2.12s/it]
epoch:27,  loss: 0.02028
133it [04:41,  2.12s/it]
epoch:28,  loss: 0.02020
133it [04:42,  2.13s/it]
epoch:29,  loss: 0.02014
133it [04:41,  2.12s/it]
epoch:30,  loss: 0.02010
model saved
133it [04:42,  2.12s/it]
epoch:31,  loss: 0.02014
133it [04:47,  2.16s/it]
epoch:32,  loss: 0.02016
133it [04:42,  2.12s/it]
epoch:33,  loss: 0.02013
133it [04:41,  2.11s/it]
epoch:34,  loss: 0.02011
133it [04:40,  2.11s/it]
epoch:35,  loss: 0.02022
133it [04:41,  2.11s/it]
epoch:36,  loss: 0.02013
133it [04:42,  2.12s/it]
epoch:37,  loss: 0.01990
133it [04:42,  2.12s/it]
epoch:38,  loss: 0.01979
133it [04:41,  2.12s/it]
epoch:39,  loss: 0.01975
133it [04:42,  2.13s/it]
epoch:40,  loss: 0.01979
model saved
133it [04:41,  2.12s/it]
epoch:41,  loss: 0.01986
133it [04:41,  2.12s/it]
epoch:42,  loss: 0.01980
133it [04:42,  2.12s/it]
epoch:43,  loss: 0.01969
133it [05:07,  2.31s/it]
epoch:44,  loss: 0.01972
133it [04:41,  2.12s/it]
epoch:45,  loss: 0.01961
133it [04:41,  2.11s/it]
epoch:46,  loss: 0.01960
133it [04:42,  2.13s/it]
epoch:47,  loss: 0.01952
133it [04:41,  2.12s/it]
epoch:48,  loss: 0.01952
133it [04:41,  2.12s/it]
epoch:49,  loss: 0.01951
133it [04:41,  2.12s/it]
epoch:50,  loss: 0.01952
model saved
133it [04:42,  2.12s/it]
epoch:51,  loss: 0.01950
133it [04:41,  2.12s/it]
epoch:52,  loss: 0.01953
133it [04:42,  2.12s/it]
epoch:53,  loss: 0.01949
133it [05:21,  2.42s/it]
epoch:54,  loss: 0.01942
133it [04:42,  2.13s/it]
epoch:55,  loss: 0.01932
133it [04:41,  2.12s/it]
epoch:56,  loss: 0.01929
133it [04:42,  2.12s/it]
epoch:57,  loss: 0.01919
133it [04:40,  2.11s/it]
epoch:58,  loss: 0.01926
133it [04:42,  2.12s/it]
epoch:59,  loss: 0.01927
133it [04:41,  2.12s/it]
epoch:60,  loss: 0.01921
model saved
133it [04:41,  2.11s/it]
epoch:61,  loss: 0.01916
133it [04:41,  2.12s/it]
epoch:62,  loss: 0.01905
133it [04:42,  2.12s/it]
epoch:63,  loss: 0.01902
133it [04:42,  2.12s/it]
epoch:64,  loss: 0.01912
133it [04:41,  2.12s/it]
epoch:65,  loss: 0.01921
133it [04:41,  2.12s/it]
epoch:66,  loss: 0.01938
133it [04:40,  2.11s/it]
epoch:67,  loss: 0.01928
133it [04:41,  2.12s/it]
epoch:68,  loss: 0.01907
133it [04:43,  2.13s/it]
epoch:69,  loss: 0.01899
133it [04:41,  2.12s/it]
epoch:70,  loss: 0.01879
model saved
133it [04:41,  2.12s/it]
epoch:71,  loss: 0.01871
133it [04:41,  2.12s/it]
epoch:72,  loss: 0.01915
133it [04:41,  2.12s/it]
epoch:73,  loss: 0.01940
133it [04:40,  2.11s/it]
epoch:74,  loss: 0.01910
133it [04:41,  2.11s/it]
epoch:75,  loss: 0.01900
133it [04:46,  2.15s/it]
epoch:76,  loss: 0.01878
133it [04:41,  2.12s/it]
epoch:77,  loss: 0.01860
133it [04:40,  2.11s/it]
epoch:78,  loss: 0.01853
133it [04:42,  2.13s/it]'''
    loss_string = loss_string.split('\n')
    loss_string = [x.split(',') for x in loss_string if x[0] == 'e']
    # import pdb; pdb.set_trace()
    loss_mse = [x[1].split(':') for x in loss_string]
    loss_mse = [float(x[1]) for x in loss_mse]
    print(loss_mse)
    plt.plot(loss_mse, label='MAE')
    plt.xlabel('Epoch')
    plt.ylabel('Loss')
    plt.title('GraphGRU Loss')
    plt.savefig('./data/graphgru_training_loss.png')


def plot_test_loss():
    test_loss = '''TIME:1 ,MAE:0.01823,  MAPE: 6962.32776, MSE: 0.00225
TIME:2 ,MAE:0.01948,  MAPE: 6834.84424, MSE: 0.00302
TIME:3 ,MAE:0.02090,  MAPE: 6878.87698, MSE: 0.00384
TIME:4 ,MAE:0.02313,  MAPE: 7459.01808, MSE: 0.00475
TIME:5 ,MAE:0.02395,  MAPE: 7261.29429, MSE: 0.00540
TIME:6 ,MAE:0.02642,  MAPE: 8515.22286, MSE: 0.00617
TIME:7 ,MAE:0.02753,  MAPE: 8314.51771, MSE: 0.00696
TIME:8 ,MAE:0.02930,  MAPE: 9555.33590, MSE: 0.00746
TIME:9 ,MAE:0.03047,  MAPE: 9878.66140, MSE: 0.00806
TIME:10 ,MAE:0.03147,  MAPE: 9913.26034, MSE: 0.00870
TIME:11 ,MAE:0.03313,  MAPE: 10480.40175, MSE: 0.00931
TIME:12 ,MAE:0.03460,  MAPE: 11706.55786, MSE: 0.00965
TIME:13 ,MAE:0.03521,  MAPE: 11605.97928, MSE: 0.01021
TIME:14 ,MAE:0.03551,  MAPE: 11429.93385, MSE: 0.01056
TIME:15 ,MAE:0.03662,  MAPE: 11953.76785, MSE: 0.01098
TIME:16 ,MAE:0.03818,  MAPE: 12944.00060, MSE: 0.01153
TIME:17 ,MAE:0.03921,  MAPE: 13456.12461, MSE: 0.01183
TIME:18 ,MAE:0.03993,  MAPE: 13606.57969, MSE: 0.01232
TIME:19 ,MAE:0.03938,  MAPE: 12589.02826, MSE: 0.01262
TIME:20 ,MAE:0.04172,  MAPE: 14468.47209, MSE: 0.01303
TIME:21 ,MAE:0.04106,  MAPE: 13807.88261, MSE: 0.01312
TIME:22 ,MAE:0.04224,  MAPE: 14133.32312, MSE: 0.01361
TIME:23 ,MAE:0.04303,  MAPE: 14622.53793, MSE: 0.01394
TIME:24 ,MAE:0.04297,  MAPE: 14217.70337, MSE: 0.01421
TIME:25 ,MAE:0.04422,  MAPE: 15213.29937, MSE: 0.01447
TIME:26 ,MAE:0.04385,  MAPE: 14119.65982, MSE: 0.01496
TIME:27 ,MAE:0.04551,  MAPE: 15772.59455, MSE: 0.01501
TIME:28 ,MAE:0.04633,  MAPE: 16062.88358, MSE: 0.01537
TIME:29 ,MAE:0.04614,  MAPE: 15508.81591, MSE: 0.01566
TIME:30 ,MAE:0.04766,  MAPE: 16587.05879, MSE: 0.01607
TIME:31 ,MAE:0.04797,  MAPE: 16656.64098, MSE: 0.01621
TIME:32 ,MAE:0.04737,  MAPE: 15958.02622, MSE: 0.01649
TIME:33 ,MAE:0.04835,  MAPE: 16590.55891, MSE: 0.01670
TIME:34 ,MAE:0.04999,  MAPE: 17986.79312, MSE: 0.01684
TIME:35 ,MAE:0.04878,  MAPE: 16675.12134, MSE: 0.01702
TIME:36 ,MAE:0.04855,  MAPE: 16234.34863, MSE: 0.01712
TIME:37 ,MAE:0.04988,  MAPE: 17397.65724, MSE: 0.01728
TIME:38 ,MAE:0.04921,  MAPE: 16454.35650, MSE: 0.01757
TIME:39 ,MAE:0.05006,  MAPE: 17255.78095, MSE: 0.01757
TIME:40 ,MAE:0.05114,  MAPE: 17824.90535, MSE: 0.01796
TIME:41 ,MAE:0.05141,  MAPE: 17869.20997, MSE: 0.01814
TIME:42 ,MAE:0.05206,  MAPE: 18205.62433, MSE: 0.01836
TIME:43 ,MAE:0.05113,  MAPE: 17239.49273, MSE: 0.01842
TIME:44 ,MAE:0.05250,  MAPE: 18431.52151, MSE: 0.01861
TIME:45 ,MAE:0.05245,  MAPE: 18309.18503, MSE: 0.01870
TIME:46 ,MAE:0.05384,  MAPE: 19382.85733, MSE: 0.01896
TIME:47 ,MAE:0.05245,  MAPE: 18002.42435, MSE: 0.01898
TIME:48 ,MAE:0.05219,  MAPE: 17264.39502, MSE: 0.01932
TIME:49 ,MAE:0.05432,  MAPE: 19540.64813, MSE: 0.01920
TIME:50 ,MAE:0.05201,  MAPE: 16934.79710, MSE: 0.01954
TIME:51 ,MAE:0.05312,  MAPE: 18017.74198, MSE: 0.01955
TIME:52 ,MAE:0.05269,  MAPE: 17298.41428, MSE: 0.01987
TIME:53 ,MAE:0.05489,  MAPE: 19497.67868, MSE: 0.01983
TIME:54 ,MAE:0.05497,  MAPE: 19626.80133, MSE: 0.01984
TIME:55 ,MAE:0.05457,  MAPE: 19093.98922, MSE: 0.01994
TIME:56 ,MAE:0.05639,  MAPE: 20704.69837, MSE: 0.01997
TIME:57 ,MAE:0.05553,  MAPE: 19669.51303, MSE: 0.02013
TIME:58 ,MAE:0.05595,  MAPE: 19971.35355, MSE: 0.02032
TIME:59 ,MAE:0.05457,  MAPE: 18441.34986, MSE: 0.02041
TIME:60 ,MAE:0.05445,  MAPE: 17986.23672, MSE: 0.02075
TIME:61 ,MAE:0.05635,  MAPE: 19840.26909, MSE: 0.02067
TIME:62 ,MAE:0.05601,  MAPE: 19599.51138, MSE: 0.02067
TIME:63 ,MAE:0.05582,  MAPE: 19389.33222, MSE: 0.02086
TIME:64 ,MAE:0.05600,  MAPE: 19647.81018, MSE: 0.02069
TIME:65 ,MAE:0.05515,  MAPE: 18606.42562, MSE: 0.02091
TIME:66 ,MAE:0.05550,  MAPE: 18823.02897, MSE: 0.02097
TIME:67 ,MAE:0.05702,  MAPE: 20433.70975, MSE: 0.02103
TIME:68 ,MAE:0.05741,  MAPE: 20718.09142, MSE: 0.02099
TIME:69 ,MAE:0.05615,  MAPE: 19164.41144, MSE: 0.02124
TIME:70 ,MAE:0.05569,  MAPE: 19145.69134, MSE: 0.02124
TIME:71 ,MAE:0.05779,  MAPE: 21018.08042, MSE: 0.02127
TIME:72 ,MAE:0.05616,  MAPE: 19238.14873, MSE: 0.02134
TIME:73 ,MAE:0.05700,  MAPE: 20435.72356, MSE: 0.02113
TIME:74 ,MAE:0.05665,  MAPE: 19873.87275, MSE: 0.02142
TIME:75 ,MAE:0.05525,  MAPE: 18504.67137, MSE: 0.02138
TIME:76 ,MAE:0.05566,  MAPE: 19072.51272, MSE: 0.02134
TIME:77 ,MAE:0.05780,  MAPE: 20973.11297, MSE: 0.02125
TIME:78 ,MAE:0.05596,  MAPE: 19283.43817, MSE: 0.02141
TIME:79 ,MAE:0.05610,  MAPE: 19618.21613, MSE: 0.02130
TIME:80 ,MAE:0.05866,  MAPE: 22183.88136, MSE: 0.02125
TIME:81 ,MAE:0.05758,  MAPE: 20694.93401, MSE: 0.02140
TIME:82 ,MAE:0.05670,  MAPE: 19973.58384, MSE: 0.02128
TIME:83 ,MAE:0.05735,  MAPE: 20823.60087, MSE: 0.02136
TIME:84 ,MAE:0.05713,  MAPE: 20101.72323, MSE: 0.02162
TIME:85 ,MAE:0.05638,  MAPE: 19555.44965, MSE: 0.02145
TIME:86 ,MAE:0.05635,  MAPE: 19721.76718, MSE: 0.02136
TIME:87 ,MAE:0.05789,  MAPE: 21180.82248, MSE: 0.02138
TIME:88 ,MAE:0.05577,  MAPE: 18797.39886, MSE: 0.02141
TIME:89 ,MAE:0.05689,  MAPE: 20118.12465, MSE: 0.02120
TIME:90 ,MAE:0.05596,  MAPE: 19297.76084, MSE: 0.02126
TIME:91 ,MAE:0.05582,  MAPE: 19106.76664, MSE: 0.02128
TIME:92 ,MAE:0.05643,  MAPE: 19609.87791, MSE: 0.02136
TIME:93 ,MAE:0.05651,  MAPE: 19719.64669, MSE: 0.02125
TIME:94 ,MAE:0.05752,  MAPE: 20984.48084, MSE: 0.02113
TIME:95 ,MAE:0.05504,  MAPE: 18488.49739, MSE: 0.02119
TIME:96 ,MAE:0.05557,  MAPE: 19027.33673, MSE: 0.02112
TIME:97 ,MAE:0.05610,  MAPE: 19300.59314, MSE: 0.02127
TIME:98 ,MAE:0.05600,  MAPE: 19073.36956, MSE: 0.02128
TIME:99 ,MAE:0.05820,  MAPE: 21390.80728, MSE: 0.02136
TIME:100 ,MAE:0.05567,  MAPE: 18788.07902, MSE: 0.02124
TIME:101 ,MAE:0.05612,  MAPE: 19493.42132, MSE: 0.02116
TIME:102 ,MAE:0.05674,  MAPE: 19823.36705, MSE: 0.02108
TIME:103 ,MAE:0.05553,  MAPE: 18598.49490, MSE: 0.02115
TIME:104 ,MAE:0.05526,  MAPE: 18756.69348, MSE: 0.02092
TIME:105 ,MAE:0.05607,  MAPE: 19292.47057, MSE: 0.02102
TIME:106 ,MAE:0.05684,  MAPE: 20026.62755, MSE: 0.02090
TIME:107 ,MAE:0.05647,  MAPE: 19591.22448, MSE: 0.02089
TIME:108 ,MAE:0.05701,  MAPE: 19966.60066, MSE: 0.02105
TIME:109 ,MAE:0.05708,  MAPE: 20161.29510, MSE: 0.02099
TIME:110 ,MAE:0.05564,  MAPE: 18936.34390, MSE: 0.02090
TIME:111 ,MAE:0.05575,  MAPE: 19277.77156, MSE: 0.02074
TIME:112 ,MAE:0.05731,  MAPE: 20600.10406, MSE: 0.02070
TIME:113 ,MAE:0.05595,  MAPE: 19077.15048, MSE: 0.02075
TIME:114 ,MAE:0.05596,  MAPE: 19187.63556, MSE: 0.02077
TIME:115 ,MAE:0.05621,  MAPE: 19368.37502, MSE: 0.02085
TIME:116 ,MAE:0.05479,  MAPE: 18087.04291, MSE: 0.02077
TIME:117 ,MAE:0.05638,  MAPE: 19621.33158, MSE: 0.02066
TIME:118 ,MAE:0.05583,  MAPE: 19062.90523, MSE: 0.02066
TIME:119 ,MAE:0.05468,  MAPE: 18010.33829, MSE: 0.02075
TIME:120 ,MAE:0.05719,  MAPE: 20289.99990, MSE: 0.02067
TIME:121 ,MAE:0.05621,  MAPE: 19313.58123, MSE: 0.02069
TIME:122 ,MAE:0.05588,  MAPE: 19449.85283, MSE: 0.02053
TIME:123 ,MAE:0.05442,  MAPE: 17855.37679, MSE: 0.02045
TIME:124 ,MAE:0.05490,  MAPE: 18133.68380, MSE: 0.02057
TIME:125 ,MAE:0.05449,  MAPE: 18029.59939, MSE: 0.02044
TIME:126 ,MAE:0.05555,  MAPE: 19236.34974, MSE: 0.02034
TIME:127 ,MAE:0.05551,  MAPE: 18995.07606, MSE: 0.02026
TIME:128 ,MAE:0.05527,  MAPE: 18995.93873, MSE: 0.02016
TIME:129 ,MAE:0.05459,  MAPE: 18489.17359, MSE: 0.02007
TIME:130 ,MAE:0.05590,  MAPE: 19656.98632, MSE: 0.02013
TIME:131 ,MAE:0.05493,  MAPE: 18885.89040, MSE: 0.02000
TIME:132 ,MAE:0.05474,  MAPE: 18671.50319, MSE: 0.01991
TIME:133 ,MAE:0.05440,  MAPE: 18475.98838, MSE: 0.01989
TIME:134 ,MAE:0.05496,  MAPE: 18851.30265, MSE: 0.02000
TIME:135 ,MAE:0.05525,  MAPE: 19396.96697, MSE: 0.01978
TIME:136 ,MAE:0.05404,  MAPE: 18359.92317, MSE: 0.01973
TIME:137 ,MAE:0.05345,  MAPE: 17852.31465, MSE: 0.01975
TIME:138 ,MAE:0.05419,  MAPE: 18613.28040, MSE: 0.01956
TIME:139 ,MAE:0.05465,  MAPE: 19000.09210, MSE: 0.01954
TIME:140 ,MAE:0.05461,  MAPE: 19130.27092, MSE: 0.01937
TIME:141 ,MAE:0.05278,  MAPE: 17674.46867, MSE: 0.01917
TIME:142 ,MAE:0.05281,  MAPE: 17907.80494, MSE: 0.01910
TIME:143 ,MAE:0.05124,  MAPE: 16757.44339, MSE: 0.01889
TIME:144 ,MAE:0.05167,  MAPE: 17169.50270, MSE: 0.01877
TIME:145 ,MAE:0.05074,  MAPE: 16722.08805, MSE: 0.01855
TIME:146 ,MAE:0.05125,  MAPE: 17287.12945, MSE: 0.01846
TIME:147 ,MAE:0.05078,  MAPE: 17356.40782, MSE: 0.01804
TIME:148 ,MAE:0.04874,  MAPE: 15978.98036, MSE: 0.01782
TIME:149 ,MAE:0.04875,  MAPE: 16258.29607, MSE: 0.01763
TIME:150 ,MAE:0.04840,  MAPE: 16639.70669, MSE: 0.01739'''
    test_loss = test_loss.split('\n')
    test_loss = [x.split(',') for x in test_loss]
    test_loss_mae = [x[1].split(':') for x in test_loss]
    test_loss_mae = [float(x[1]) for x in test_loss_mae]
    print(test_loss_mae)
    plt.plot(test_loss_mae, label='MAE')
    plt.xlabel('Time')
    plt.ylabel('Loss')
    plt.title('GraphGRU Test Loss')

    test_loss_mse = [x[3].split(':') for x in test_loss]
    test_loss_mse = [float(x[1]) for x in test_loss_mse]
    print(test_loss_mse)
    plt.plot(test_loss_mse, label='MSE')
    plt.xlabel('Time')
    plt.ylabel('Loss')
    plt.title('GraphGRU Test Loss')
    plt.legend()
    # plt.show()
    plt.savefig('./data/graphgru_test_loss.png')


if __name__ == '__main__':
    # plot_loss()
    # plot_loss_from_string()
    plot_test_loss()